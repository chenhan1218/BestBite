# BestBite æ¶æ§‹è¨­è¨ˆæ–‡æª”

## ğŸ—ï¸ ç³»çµ±æ¶æ§‹æ¦‚è¦½

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ç”¨æˆ¶è¨­å‚™ (PWA)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚            React + Next.js App (Browser)             â”‚  â”‚
â”‚  â”‚                                                       â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚ Home Page   â”‚  â”‚ Inventory    â”‚  â”‚ Modal      â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ (Camera)    â”‚  â”‚ Dashboard    â”‚  â”‚ (Confirm)  â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚         â”‚                â”‚                           â”‚  â”‚
â”‚  â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚                                                   â”‚   â”‚  â”‚
â”‚  â”‚                  FoodContext (State)             â”‚   â”‚  â”‚
â”‚  â”‚              (Redux-like State Management)       â”‚   â”‚  â”‚
â”‚  â”‚                                                   â”‚   â”‚  â”‚
â”‚  â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚   â”‚  â”‚
â”‚  â”‚         â”‚ useFoodItems Hook (CRUD ops)    â”‚     â”‚   â”‚  â”‚
â”‚  â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚   â”‚  â”‚
â”‚  â”‚                        â”‚                         â”‚   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”€â”€â”€â”˜  â”‚
â”‚                           â”‚                         â”‚       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚         Local Storage (IndexedDB)                 â”‚     â”‚ â”‚
â”‚  â”‚  [ç”¨æ–¼é›¢ç·šæ”¯æ´å’Œå¿«é€Ÿæª¢ç´¢]                        â”‚     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚ â”‚
â”‚                           â”‚                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚             â”‚             â”‚
              â–¼             â–¼             â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Vercel  â”‚  â”‚ Firebase â”‚  â”‚  Google  â”‚
        â”‚(CDN/API) â”‚  â”‚(Firestoreâ”‚  â”‚  Gemini  â”‚
        â”‚          â”‚  â”‚+Storage) â”‚  â”‚   API    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ æ•¸æ“šæµ (Data Flow)

### 1ï¸âƒ£ æ·»åŠ é£Ÿå“æµç¨‹

```
CameraButton.tsx (ç”¨æˆ¶é»æ“Š)
    â†“
ImageUpload.tsx (é¸æ“‡æˆ–æ‹æ”ç…§ç‰‡)
    â†“
åœ–ç‰‡å£“ç¸® (image.ts)
    â†“
ç™¼é€ POST /api/gemini (å¸¶ Base64)
    â†“
Gemini API è¿”å›: { product_name, expiry_date, confidence }
    â†“
ConfirmationModal.tsx (ç”¨æˆ¶ç¢ºèªæˆ–ç·¨è¼¯)
    â†“
useFoodItems.addFoodItem(data)
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FoodContext (Redux)     â”‚
â”‚ æ›´æ–°å…¨å±€ foodItems[]    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”œâ”€â†’ ä¿å­˜åˆ° Firestore (firebase.ts)
             â”‚
             â”œâ”€â†’ ä¿å­˜åˆ° IndexedDB (storage.ts)
             â”‚
             â””â”€â†’ è§¸ç™¼ UI æ›´æ–° (React re-render)
```

### 2ï¸âƒ£ æŸ¥çœ‹æ¸…å–®æµç¨‹

```
Home Page (çµ±è¨ˆæ•¸å­—)
    â†“
é»æ“Šã€ŒæŸ¥çœ‹æ¸…å–®ã€
    â†“
é€²å…¥ Inventory Page
    â†“
FoodContext.getFoodItems()
    â†“
è®€å– IndexedDB (å¿«é€Ÿ)
    â†“
æˆ–åŒæ­¥ Firestore (æœ€æ–°æ•¸æ“š)
    â†“
FoodList.tsx
  â”œâ”€ è¨ˆç®— days_until_expiry
  â”œâ”€ åˆ†é… status (red/yellow/green)
  â”œâ”€ æ’åºå’Œåˆ†çµ„
  â”‚
  â””â”€ æ¸²æŸ“ï¼š
      â”œâ”€ ç´…ç‡ˆå€ (ğŸ”´ ç´…è‰²èƒŒæ™¯ï¼Œå¤§å­—é«”)
      â”œâ”€ é»ƒç‡ˆå€ (ğŸŸ¡ é»ƒè‰²èƒŒæ™¯)
      â””â”€ ç¶ ç‡ˆå€ (ğŸŸ¢ ç¶ è‰²èƒŒæ™¯)
```

---

## ğŸ“ çµ„ä»¶æ¨¹çµæ§‹

```
<RootLayout>
  â”‚
  â”œâ”€ <HomePage>
  â”‚   â”œâ”€ <CameraButton />         (å·¨å¤§ç›¸æ©ŸæŒ‰éˆ•)
  â”‚   â”œâ”€ <QuickStats />            (X å€‹ç´…ç‡ˆ / X å€‹é»ƒç‡ˆ / X å€‹ç¶ ç‡ˆ)
  â”‚   â””â”€ <FoodContext.Provider>
  â”‚
  â”œâ”€ <InventoryPage>
  â”‚   â”œâ”€ <Header />                (æ¨™é¡Œ + è¿”å›æŒ‰éˆ•)
  â”‚   â”œâ”€ <FoodList>
  â”‚   â”‚   â”œâ”€ <RedZone>             (ç´…ç‡ˆå€ - ç½®é ‚)
  â”‚   â”‚   â”‚   â””â”€ <FoodItemCard>[] (å¤šå€‹é …ç›®)
  â”‚   â”‚   â”œâ”€ <YellowZone>
  â”‚   â”‚   â”‚   â””â”€ <FoodItemCard>[]
  â”‚   â”‚   â””â”€ <GreenZone>
  â”‚   â”‚       â””â”€ <FoodItemCard>[]
  â”‚   â””â”€ <FoodContext.Provider>
  â”‚
  â””â”€ <Modal>
      â””â”€ <ConfirmationModal>       (AI çµæœç¢ºèª)
          â”œâ”€ ç”¢å“åç¨±è¼¸å…¥æ¡†
          â”œâ”€ æœ‰æ•ˆæœŸè¼¸å…¥æ¡†
          â”œâ”€ åœ–ç‰‡é è¦½
          â””â”€ ç¢ºèª / å–æ¶ˆ æŒ‰éˆ•
```

---

## ğŸ§  ç‹€æ…‹ç®¡ç† (FoodContext)

### Context çµæ§‹

```typescript
interface FoodContextType {
  // ç‹€æ…‹
  foodItems: FoodItem[]
  loading: boolean
  error: string | null

  // æ“ä½œ
  addFoodItem(data: FoodItemInput): Promise<void>
  updateFoodItem(id: string, data: Partial<FoodItem>): Promise<void>
  deleteFoodItem(id: string): Promise<void>
  getFoodItems(userId?: string): Promise<void>

  // è¨ˆç®—å±¬æ€§
  redItems: FoodItem[]      // status === 'red'
  yellowItems: FoodItem[]   // status === 'yellow'
  greenItems: FoodItem[]    // status === 'green'
}
```

### åˆå§‹åŒ–å’ŒåŒæ­¥ç­–ç•¥

```typescript
// 1. æ‡‰ç”¨å•Ÿå‹•æ™‚
useEffect(() => {
  // å¾ IndexedDB å¿«é€ŸåŠ è¼‰
  loadFromLocalStorage()

  // åŒæ™‚å¾ Firestore åŒæ­¥æœ€æ–°æ•¸æ“š
  syncFromFirestore()
}, [])

// 2. æ·»åŠ é …ç›®æ™‚
const addFoodItem = async (data) => {
  // ç«‹å³æ›´æ–°æœ¬åœ°ç‹€æ…‹ (æ¨‚è§€æ›´æ–°)
  setFoodItems([...foodItems, data])

  // ä¿å­˜åˆ° Firestore
  await firestore.add(data)

  // ä¿å­˜åˆ° IndexedDB
  await storage.save(data)
}

// 3. å¯¦æ™‚ç›£è½ Firestore è®ŠåŒ–
unsubscribe = db.collection('foodItems')
  .onSnapshot(snapshot => {
    updateLocalState(snapshot)
  })
```

---

## ğŸ”Œ API è·¯ç”±è¨­è¨ˆ

### POST /api/gemini (åœ–åƒè­˜åˆ¥)

**è«‹æ±‚:**
```typescript
interface GeminiRequest {
  image: string              // Base64 ç·¨ç¢¼çš„åœ–ç‰‡
  mimeType: string           // "image/jpeg" | "image/png"
}
```

**å›æ‡‰:**
```typescript
interface GeminiResponse {
  product_name: string       // "ç¾©ç¾å°æ³¡èŠ™"
  expiry_date: string        // "2025-12-25"
  confidence: number         // 0-100
  notes?: string             // é¡å¤–ä¿¡æ¯æˆ–è­¦å‘Š
}
```

**å¯¦ç¾é‚è¼¯:**
```typescript
// route.ts
export async function POST(request: Request) {
  const { image, mimeType } = await request.json()

  // èª¿ç”¨ Gemini API
  const response = await gemini.generateContent({
    contents: [{
      parts: [{
        inlineData: {
          data: image,
          mimeType
        }
      }, {
        text: "è­˜åˆ¥ç”¢å“åç¨±å’Œæœ‰æ•ˆæœŸ..."
      }]
    }]
  })

  // è§£æå’Œé©—è­‰
  const parsed = parseGeminiResponse(response)

  // è¿”å›
  return Response.json(parsed)
}
```

---

## ğŸ’¾ Firebase é›†åˆè¨­è¨ˆ

### æ•¸æ“šåº«çµæ§‹

```
Firestore Database
â”‚
â”œâ”€ users/                          # ç”¨æˆ¶é›†åˆ
â”‚  â””â”€ {userId}/
â”‚     â”œâ”€ profile (æ–‡æª”)
â”‚     â”‚  â”œâ”€ name: string
â”‚     â”‚  â”œâ”€ email: string
â”‚     â”‚  â””â”€ created_at: timestamp
â”‚     â”‚
â”‚     â””â”€ food_items/ (å­é›†åˆ)
â”‚        â””â”€ {itemId} (æ–‡æª”)
â”‚           â”œâ”€ product_name: string
â”‚           â”œâ”€ expiry_date: string (YYYY-MM-DD)
â”‚           â”œâ”€ days_until_expiry: number
â”‚           â”œâ”€ status: "red" | "yellow" | "green"
â”‚           â”œâ”€ image_url: string
â”‚           â”œâ”€ confidence: number
â”‚           â”œâ”€ created_at: timestamp
â”‚           â””â”€ updated_at: timestamp
â”‚
â””â”€ Storage/                        # Firebase Storage
   â””â”€ users/
      â””â”€ {userId}/
         â””â”€ food_images/
            â””â”€ {itemId}.jpg
```

### ç´¢å¼•å’ŒæŸ¥è©¢å„ªåŒ–

```typescript
// æŸ¥è©¢æ‰€æœ‰é£Ÿå“é … (æŒ‰éæœŸæ—¥æœŸæ’åº)
db.collection('users')
  .doc(userId)
  .collection('food_items')
  .orderBy('expiry_date', 'asc')
  .get()

// æŸ¥è©¢ç´…ç‡ˆé … (7 å¤©å…§)
db.collection('users')
  .doc(userId)
  .collection('food_items')
  .where('status', '==', 'red')
  .orderBy('expiry_date', 'asc')
  .get()
```

---

## ğŸ–¼ï¸ çµ„ä»¶è©³ç´°è¨­è¨ˆ

### CameraButton.tsx

```typescript
interface CameraButtonProps {
  onImageSelected: (file: File) => void
  loading?: boolean
}

export function CameraButton({ onImageSelected, loading }: Props) {
  // åŠŸèƒ½:
  // 1. é»æ“Šæ‰“é–‹åŸç”Ÿç›¸æ©Ÿ (mobile) æˆ–æª”æ¡ˆé¸æ“‡ (desktop)
  // 2. é¡¯ç¤ºã€Œæ‹æ”ä¸­...ã€ç‹€æ…‹
  // 3. å›èª¿è¿”å›é¸å®šçš„æ–‡ä»¶

  // å°ºå¯¸: 80x80px (åœ“å½¢æŒ‰éˆ•)
  // å­—é«”: 48px emoji ğŸ“·
  // é¡è‰²: è—è‰²èƒŒæ™¯ + ç™½è‰²åœ–æ¨™
}
```

### FoodItemCard.tsx

```typescript
interface FoodItemCardProps {
  item: FoodItem
  status: 'red' | 'yellow' | 'green'
  onDelete: (id: string) => void
  onEdit: (id: string) => void
}

export function FoodItemCard({ item, status, onDelete, onEdit }: Props) {
  // åŠŸèƒ½:
  // 1. é¡¯ç¤ºç”¢å“åç¨± (å¤§å­— 24px)
  // 2. é¡¯ç¤ºéæœŸæ—¥æœŸ (format: "12æœˆ25æ—¥")
  // 3. é¡¯ç¤ºå‰©é¤˜å¤©æ•¸ (format: "é‚„æœ‰ X å¤©")
  // 4. é¡¯ç¤ºç”¢å“åœ–ç‰‡ç¸®åœ–
  // 5. é•·æŒ‰æˆ–å‘å·¦æ»‘å‹•åˆªé™¤

  // å°ºå¯¸æ ¹æ“šç‹€æ…‹:
  // - Red: padding 24px, å­—é«”æ›´å¤§ (28px)
  // - Yellow/Green: padding 16px, å­—é«” 20px
}
```

### ConfirmationModal.tsx

```typescript
interface ConfirmationModalProps {
  imagePreview: string
  geminiResult: GeminiResponse
  onConfirm: (data: FoodItemInput) => void
  onCancel: () => void
}

export function ConfirmationModal({
  imagePreview,
  geminiResult,
  onConfirm,
  onCancel
}: Props) {
  // åŠŸèƒ½:
  // 1. å±•ç¤ºåœ–ç‰‡é è¦½ (å·¦å´)
  // 2. å±•ç¤ºè­˜åˆ¥çµæœ (å³å´ï¼Œå¯ç·¨è¼¯)
  //    - ç”¢å“åç¨±è¼¸å…¥æ¡†
  //    - æœ‰æ•ˆæœŸé¸æ“‡å™¨
  //    - ä¿¡å¿ƒåº¦é¡¯ç¤º
  // 3. ç¢ºèª/å–æ¶ˆæŒ‰éˆ•

  // è¨­è¨ˆ: é©æ‡‰ç§»å‹•è¨­å‚™ï¼Œ2 åˆ—å¸ƒå±€ (å¤§å±) / 1 åˆ—å †ç–Š (å°å±)
}
```

---

## ğŸ” å®‰å…¨è€ƒæ…®

### API å¯†é‘°ç®¡ç†

```env
# ç’°å¢ƒè®Šæ•¸åˆ†å±¤
NEXT_PUBLIC_*         # å…¬é–‹è®Šæ•¸ï¼ˆæš´éœ²çµ¦ç€è¦½å™¨ï¼‰
(ç„¡å‰ç¶´)              # ç§æœ‰è®Šæ•¸ï¼ˆåƒ…åœ¨æœå‹™å™¨é‹è¡Œï¼‰

# ç¤ºä¾‹
NEXT_PUBLIC_FIREBASE_API_KEY=xxx      # æš´éœ²
GEMINI_API_KEY=xxx                    # ç§æœ‰ (API è·¯ç”±ä¸­ä½¿ç”¨)
```

### æ•¸æ“šé©—è­‰

```typescript
// åœ¨ä¿å­˜å‰é©—è­‰
function validateFoodItem(data: any): FoodItem {
  if (!data.product_name || data.product_name.trim() === '') {
    throw new Error('ç”¢å“åç¨±ä¸èƒ½ç‚ºç©º')
  }

  const date = new Date(data.expiry_date)
  if (isNaN(date.getTime())) {
    throw new Error('æœ‰æ•ˆæœŸæ—¥æœŸç„¡æ•ˆ')
  }

  return {
    product_name: data.product_name.trim(),
    expiry_date: data.expiry_date,
    // ... å…¶ä»–å­—æ®µ
  }
}
```

### åœ–ç‰‡å®‰å…¨

```typescript
// å£“ç¸®åœ–ç‰‡ä»¥é™åˆ¶å¤§å°
async function compressImage(file: File): Promise<Blob> {
  const canvas = await new Promise<HTMLCanvasElement>(resolve => {
    const img = new Image()
    img.onload = () => {
      const canvas = document.createElement('canvas')
      const ratio = Math.min(800 / img.width, 800 / img.height)
      canvas.width = img.width * ratio
      canvas.height = img.height * ratio
      canvas.getContext('2d')!.drawImage(img, 0, 0, canvas.width, canvas.height)
      resolve(canvas)
    }
    img.src = URL.createObjectURL(file)
  })

  return new Promise(resolve => {
    canvas.toBlob(blob => resolve(blob!), 'image/jpeg', 0.8)
  })
}
```

---

## ğŸ“± éŸ¿æ‡‰å¼è¨­è¨ˆæ–·é»

```typescript
// Tailwind æ–·é»
const breakpoints = {
  sm: '640px',   // æ‰‹æ©Ÿæ©«å±
  md: '768px',   // å¹³æ¿
  lg: '1024px',  // æ¡Œé¢
  xl: '1280px',  // å¯¬å±
}

// ä½ˆå±€èª¿æ•´
// - xs-md: å–®åˆ—å¸ƒå±€ (å †ç–Š)
// - md+: é›™åˆ—å¸ƒå±€ (ä¸¦è¡Œ)

// ç¤ºä¾‹: ConfirmationModal
<div className="grid grid-cols-1 md:grid-cols-2 gap-8">
  <ImagePreview />         {/* å·¦åˆ— (md+) */}
  <FormFields />           {/* å³åˆ— (md+) */}
</div>
```

---

## ğŸ§ª æ¸¬è©¦ç­–ç•¥

### å–®å…ƒæ¸¬è©¦ (Jest + React Testing Library)

```typescript
// ç¤ºä¾‹: FoodItemCard æ¸¬è©¦
describe('FoodItemCard', () => {
  it('displays product name correctly', () => {
    const item = { product_name: 'å°æ³¡èŠ™', expiry_date: '2025-12-25' }
    render(<FoodItemCard item={item} status="green" />)
    expect(screen.getByText('å°æ³¡èŠ™')).toBeInTheDocument()
  })

  it('calls onDelete when swiped left', () => {
    const onDelete = jest.fn()
    render(<FoodItemCard item={item} status="green" onDelete={onDelete} />)
    // æ¨¡æ“¬æ»‘å‹•äº‹ä»¶
    // é©—è­‰ onDelete è¢«èª¿ç”¨
  })
})
```

### é›†æˆæ¸¬è©¦

```typescript
// ç¤ºä¾‹: å®Œæ•´çš„æ·»åŠ é£Ÿå“æµç¨‹
describe('Add Food Item Flow', () => {
  it('should save food item after AI confirmation', async () => {
    // 1. é»æ“Šç›¸æ©ŸæŒ‰éˆ•
    // 2. é¸æ“‡åœ–ç‰‡
    // 3. é©—è­‰ Gemini API è¢«èª¿ç”¨
    // 4. ç¢ºèªçµæœ
    // 5. é©—è­‰ Firestore ä¸­çš„æ•¸æ“š
    // 6. é©—è­‰ UI æ›´æ–°
  })
})
```

### E2E æ¸¬è©¦ (Playwright/Cypress)

```typescript
// ç¤ºä¾‹: ç§»å‹•è¨­å‚™ä¸Šçš„å®Œæ•´ç”¨æˆ¶æµç¨‹
test('user can add and view food items on mobile', async ({ page }) => {
  await page.goto('http://localhost:3000')

  // 1. é¦–é æ‡‰é¡¯ç¤ºç›¸æ©ŸæŒ‰éˆ•
  await expect(page.getByRole('button', { name: /camera/i })).toBeVisible()

  // 2. é»æ“Šç›¸æ©ŸæŒ‰éˆ•
  await page.getByRole('button', { name: /camera/i }).click()

  // 3. ä¸Šå‚³åœ–ç‰‡
  await page.setInputFiles('input[type="file"]', 'test-image.jpg')

  // 4. ç­‰å¾… AI è­˜åˆ¥
  await expect(page.getByText(/è­˜åˆ¥ä¸­/)).toBeVisible()

  // 5. ç¢ºèªçµæœ
  await page.getByRole('button', { name: /ç¢ºèª/i }).click()

  // 6. é©—è­‰é …ç›®å‡ºç¾åœ¨æ¸…å–®ä¸­
  await expect(page.getByText(/å°æ³¡èŠ™/)).toBeVisible()
})
```

---

## ğŸš€ æ€§èƒ½å„ªåŒ–

### åœ–ç‰‡å„ªåŒ–
- è‡ªå‹•å£“ç¸®åˆ° < 2MB (JPEG 80% è³ªé‡)
- ä½¿ç”¨ WebP æ ¼å¼ (å¦‚æœæ”¯æ´)
- å»¶é²åŠ è¼‰ (Intersection Observer)

### ä»£ç¢¼åˆ†å‰²
```typescript
// å‹•æ…‹å°å…¥å¤§å‹çµ„ä»¶
const InventoryPage = dynamic(() => import('./inventory'), { ssr: false })
```

### ç‹€æ…‹ç®¡ç†å„ªåŒ–
```typescript
// ä½¿ç”¨ useCallback é˜²æ­¢ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“
const addFoodItem = useCallback(async (data) => {
  // ...
}, [])

// ä½¿ç”¨ useMemo å„ªåŒ–è¨ˆç®—
const redItems = useMemo(() =>
  foodItems.filter(item => item.status === 'red'),
  [foodItems]
)
```

---

**Last Updated:** 2025-12-15
**Architect:** Claude Code ğŸ¤–
